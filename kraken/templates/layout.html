<!doctype html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
		<style>
			{% include 'style.css' %}
		</style>
	</head>
	<body>
		<script language="javascript" type="text/javascript">
			{% include 'jquery-1.11.3.min.js' %}
			{% include 'jquery.maphilight.min.js' %}
			{% include 'imageMapResizer.min.js' %}
		</script>
		<script>
			$(document).ready(function() {
				$('map').imageMapResize();
				$('img[usemap]').maphilight({"fill": false});
				$('area').click(function(e) {
					$('#' + $(this).attr('alt')).focus();
				});
				$('li[contenteditable=true], span').mouseover(function(e) {
					$('area[alt=' + this.id + ']').mouseover();
				}).mouseout(function(e) {
					$('area[alt=' + this.id + ']').mouseout();
				}).focusin(function(e) {
					$('area[alt=' + this.id + ']').data('maphilight', {'alwaysOn': true}).trigger('alwaysOn.maphilight');
				}).focusout(function(e) {
					$('area[alt=' + this.id + ']').data('maphilight', {'alwaysOn': false}).trigger('alwaysOn.maphilight');
				}).keydown(function(e) {
					if(e.which == 13) {
						e.preventDefault();
						$(this).addClass('corrected');
						var $els = $('[contenteditable=true]');
						$els.eq($els.index(this) + 1).focus();
					}
				});
			});
		</script>
		{% for page in pages %}
		<div class="container page" id="page_{{ page.index }}">
			<div class="column">
				<img class="page_image" usemap="#elements_{{ page.index }}" src='{{ page.img }}' alt="photo"/>
			</div>
			<div class="column">
				<div class='text_fields'>
				<ul>
				{% for line in page.lines %}
					{% if line.recognition %}
						<li data-bbox="{{ line.bbox }}">
							{% for segment in line.recognition %}
							<span id="segment_{{ segment.index }}" contenteditable="true" spellcheck="true" data-bbox="{{ segment.bbox }}">{{ segment.text }}</span>
							{% endfor %}
						</li>
					{% else %}
					<li id="line_{{ line.index }}" contenteditable="true" spellcheck="true" data-bbox="{{ line.bbox }}" data-placeholder="Enter text for line {{ line.index }}"></li>
					{% endif %}
				{% endfor %}
				</ul>
				</div>

			</div>

			<map name="elements_{{ page.index}}">
				{% for line in page.lines %}
					{% if line.recognition %}
						{% for segment in line.recognition %}
						<area shape="rect" coords="{{ segment.bbox }}" alt="segment_{{ segment.index }}"/>
						{% endfor %}
					{% else %}
						<area shape="rect" coords="{{ line.bbox }}" alt="line_{{ line.index }}"/>
					{% endif %}
				{% endfor %}
			</map>
		</div>
		{% endfor %}
	</body>
</html>
